<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MTG Market Cap - A Magic: The Gathering Finance Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
  <style>
    /* -----------------------
       Default (Light) Theme
       ----------------------- */
    :root {
      /* Light theme colors */
      --bg-color: #ffffff;
      --text-color: #000000;
      --accent-bg-color: #d1ecf1;  /* highlight for .active-set */
      --link-color: #0056b3;
      --table-bg: #f8f9fa;
      --table-border: #dee2e6;

      /* Row striping in Light theme */
      --row-bg-1: #ffffff; /* a pure white row */
      --row-bg-2: #f0f0f0; /* slightly grayer row */
    }

    body {
      margin-top: 20px;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    a, a:hover {
      color: var(--link-color);
    }

    .thumbnail-img {
      max-width: 80px;
    }
    h1 {
      margin-bottom: 30px;
    }

    .small-col {
      width: 50px;
    }
    /* Style for the set icon menu */
    .set-icon {
      width: 80px;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    .set-menu a {
      text-decoration: none;
      display: block;
      color: inherit;
    }
    .set-menu a:hover {
      text-decoration: underline;
    }
    /* Flex container to align the set icon and name with name at bottom */
    .set-item {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      height: 120px; /* adjust as needed */
    }
    /* Highlight active set */
    .active-set {
      background-color: var(--accent-bg-color);
      border-radius: 8px;
      padding: 5px;
    }

    /* Table styling (light theme) */
    table.dataTable {
      background-color: var(--table-bg);
      border-color: var(--table-border);
    }
    /* Row striping for Light theme */
    table.dataTable tbody tr:nth-child(odd) {
      background-color: var(--row-bg-1);
    }
    table.dataTable tbody tr:nth-child(even) {
      background-color: var(--row-bg-2);
    }

    /* -----------
       DARK THEME
       ----------- */
    body.dark-theme {
      --bg-color: #181a1b;
      --text-color: #f8f9fa;
      --accent-bg-color: #304b54;
      --link-color: #63b3ed;
      --table-bg: #222427;
      --table-border: #44484c;
      --row-bg-1: #2e2f31;
      --row-bg-2: #343638;
    }
    body.dark-theme table.dataTable,
    body.dark-theme table.dataTable tbody tr td,
    body.dark-theme table.dataTable thead tr th {
      color: #fff !important;
    }

    /* ---------------
       PSYCHEDELIC THEME
       --------------- */
    body.psychedelic-theme {
      --bg-color: linear-gradient(45deg, #ff0080, #fcb900, #00c6ff);
      --text-color: #ffffff;
      --accent-bg-color: rgba(255, 255, 255, 0.3);
      --link-color: #fff700;
      --table-bg: rgba(0, 0, 0, 0.4);
      --table-border: #ffffff;
      --row-bg-1: rgba(255, 255, 255, 0.1);
      --row-bg-2: rgba(255, 255, 255, 0.25);
    }
    body.psychedelic-theme {
      background: var(--bg-color); /* note background is a gradient */
      background-size: 400% 400%;
      animation: gradient-flow 15s ease infinite;
      color: var(--text-color);
    }
    @keyframes gradient-flow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    body.psychedelic-theme .active-set {
      background-color: var(--accent-bg-color);
    }
    .psychedelic-theme a,
    .psychedelic-theme a:hover {
      color: var(--link-color);
    }
    .psychedelic-theme table.dataTable {
      background-color: var(--table-bg);
      border-color: var(--table-border);
    }
    body.psychedelic-theme table.dataTable tbody tr:nth-child(odd) {
      background-color: var(--row-bg-1);
    }
    body.psychedelic-theme table.dataTable tbody tr:nth-child(even) {
      background-color: var(--row-bg-2);
    }

    /* ------------
       PURPLE THEME
       ------------ */
    body.purple-theme {
      --bg-color: #4b0082; /* indigo-ish background */
      --text-color: #ffffff;
      --accent-bg-color: #7d3fb2; /* highlight a lighter purple? */
      --link-color: #e5b3ff;
      --table-bg: #3f006f;
      --table-border: #8b55cc;
      --row-bg-1: #551a8b;
      --row-bg-2: #6e2398;
      color: var(--text-color);
    }
    body.purple-theme table.dataTable,
    body.purple-theme table.dataTable tbody tr td,
    body.purple-theme table.dataTable thead tr th {
      color: #fff !important;
    }
    body.purple-theme table.dataTable tbody tr:nth-child(odd) {
      background-color: var(--row-bg-1);
    }
    body.purple-theme table.dataTable tbody tr:nth-child(even) {
      background-color: var(--row-bg-2);
    }

    /* ---------------
       ACID GREEN THEME
       --------------- */
    body.acid-theme {
      --bg-color: #2eff2e; /* bright acid green */
      --text-color: #000000;
      --accent-bg-color: #91ff91;
      --link-color: #006600;
      --table-bg: #c3ffc3;
      --table-border: #76ff76;
      --row-bg-1: #b0ffb0;
      --row-bg-2: #d2ffd2;
      color: var(--text-color);
    }
    body.acid-theme table.dataTable,
    body.acid-theme table.dataTable tbody tr td,
    body.acid-theme table.dataTable thead tr th {
      color: #000 !important;
    }
    body.acid-theme table.dataTable tbody tr:nth-child(odd) {
      background-color: var(--row-bg-1);
    }
    body.acid-theme table.dataTable tbody tr:nth-child(even) {
      background-color: var(--row-bg-2);
    }

    /* ---------------
       MATRIX THEME
       --------------- */
    body.matrix-theme {
      --bg-color: #000000;  /* black background */
      --text-color: #00ff00; /* bright green text */
      --accent-bg-color: #003300; /* darker highlight */
      --link-color: #00ff00; /* all green links too? */
      --table-bg: #000000;
      --table-border: #004400;
      --row-bg-1: #001900; /* very dark greenish */
      --row-bg-2: #002200; /* a bit brighter greenish black */
      color: var(--text-color);
    }
    body.matrix-theme table.dataTable,
    body.matrix-theme table.dataTable tbody tr td,
    body.matrix-theme table.dataTable thead tr th {
      color: #00ff00 !important;
    }
    body.matrix-theme table.dataTable tbody tr:nth-child(odd) {
      background-color: var(--row-bg-1);
    }
    body.matrix-theme table.dataTable tbody tr:nth-child(even) {
      background-color: var(--row-bg-2);
    }

  </style>
</head>
<body>
  <div class="container">

    <!-- Header row: Title, plus theme selector in the upper-right -->
    <div class="row">
      <div class="col-md-8">
        <h1>MTG Market Cap<br><small>A Magic: The Gathering finance tool</small></h1>
      </div>
      <div class="col-md-4 text-right mt-3">
        <label for="themeSelect"><strong>Theme:</strong></label>
        <select id="themeSelect" class="ml-2">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="psychedelic">Psychedelic</option>
          <option value="purple">Purple</option>
          <option value="acid">Acid Green</option>
          <option value="matrix">Matrix</option>
        </select>
      </div>
    </div>

    <!-- Row for showing last update & total marketcap -->
    <div class="row mb-3">
      <div class="col-md-12 text-center">
        <p><strong>Last Update (UTC):</strong> {{ last_update }}</p>
        <p><strong>Total Market Cap:</strong>
          {% if total_marketcap is not none %}
            ${{ "{:,.2f}".format(total_marketcap|float) }}
          {% else %}
            N/A
          {% endif %}
        </p>
      </div>
    </div>

    <!-- Set Menu: Clickable icons from the web -->
    <div class="row mb-4 set-menu">
      <div class="col text-center">
        <a href="/?set=lea" class="{% if set_name == 'lea' %}active-set{% endif %}">
          <div class="set-item">
            <img src="http://eakett.ca/mtgimage/symbol/set/lea/c/256.png" alt="LEA" class="set-icon">
            <div>Alpha</div>
          </div>
        </a>
      </div>
      <div class="col text-center">
        <a href="/?set=leb" class="{% if set_name == 'leb' %}active-set{% endif %}">
          <div class="set-item">
            <img src="http://eakett.ca/mtgimage/symbol/set/leb/c/256.png" alt="LEB" class="set-icon">
            <div>Beta</div>
          </div>
        </a>
      </div>
      <div class="col text-center">
        <a href="/?set=2ed" class="{% if set_name == '2ed' %}active-set{% endif %}">
          <div class="set-item">
            <img src="http://eakett.ca/mtgimage/symbol/set/2ed/c/256.png" alt="2ED" class="set-icon">
            <div>Unlimited</div>
          </div>
        </a>
      </div>
      <div class="col text-center">
        <a href="/?set=drk" class="{% if set_name == 'drk' %}active-set{% endif %}">
          <div class="set-item">
            <img src="http://eakett.ca/mtgimage/symbol/set/drk/c/256.png" alt="DRK" class="set-icon">
            <div>The Dark</div>
          </div>
        </a>
      </div>
      <div class="col text-center">
        <a href="/?set=leg" class="{% if set_name == 'leg' %}active-set{% endif %}">
          <div class="set-item">
            <img src="http://eakett.ca/mtgimage/symbol/set/leg/c/256.png" alt="LEG" class="set-icon">
            <div>Legends</div>
          </div>
        </a>
      </div>
      <div class="col text-center">
        <a href="/?set=arn" class="{% if set_name == 'arn' %}active-set{% endif %}">
          <div class="set-item">
            <img src="http://eakett.ca/mtgimage/symbol/set/arn/c/256.png" alt="ARN" class="set-icon">
            <div>Arabian Nights</div>
          </div>
        </a>
      </div>
      <div class="col text-center">
        <a href="/?set=atq" class="{% if set_name == 'atq' %}active-set{% endif %}">
          <div class="set-item">
            <img src="http://eakett.ca/mtgimage/symbol/set/atq/c/256.png" alt="ATQ" class="set-icon">
            <div>Antiquities</div>
          </div>
        </a>
      </div>
    </div>

    <!-- DataTables table for card listings -->
    <!-- DataTables table for card listings -->
    <table id="cardsTable" class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Prints</th>
          <th>Last Price (USD)</th>
          <th>Market Cap</th>
        </tr>
      </thead>
      <tbody>
        {% for card in cards %}
        <tr>
          <!-- Thumbnail -->
          <td>
            {% if card.image_thumbnail %}
              <img src="{{ card.image_thumbnail }}" alt="{{ card.name }} thumbnail" class="thumbnail-img">
            {% endif %}
          </td>
          <!-- Card Name -->
          <td>{{ card.name }}</td>
          <!-- Prints/Supply -->
          <td>{{ card.print_count }}</td>
          <!-- Price (USD) -->
          <td data-order="{% if card.latest_price_usd and card.latest_price_usd != '' %}{{ card.latest_price_usd|float }}{% else %}0{% endif %}">
            {% if card.latest_price_usd %}
              {{ "{:,.2f}".format(card.latest_price_usd|float) }}
            {% else %}
              N/A
            {% endif %}
          </td>
          <!-- Market Cap -->
          <td data-order="{% if card.market_cap and card.market_cap != '' %}{{ card.market_cap|float }}{% else %}0{% endif %}">
            {% if card.market_cap %}
              {{ "{:,.2f}".format(card.market_cap|float) }}
            {% else %}
              N/A
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>


    <!-- Link to Methodology Markdown at the bottom of the page -->
    <div class="container mt-4">
      <p>
        <a href="methodology.md" target="_blank">
          View Methodology (Markdown)
        </a>
      </p>
    </div>

  </div> <!-- End of main container -->

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    // On page load, set up DataTables
    $(document).ready(function(){
      $('#cardsTable').DataTable({
          "order": [[4, "desc"]],
          "searching": true,
          "paging": true,   // Enables pagination
          "lengthMenu": [10, 25, 50, 100], // Options for rows per page
          "pageLength": 25  // Default rows per page
      });

      // At page load, see if we had stored a theme previously
      const storedTheme = localStorage.getItem('selectedTheme');
      if(storedTheme) {
        setTheme(storedTheme);
        document.getElementById('themeSelect').value = storedTheme;
      }
    });

    // Theme switching script
    const themeSelect = document.getElementById('themeSelect');
    themeSelect.addEventListener('change', function() {
      const chosen = this.value;
      localStorage.setItem('selectedTheme', chosen);
      setTheme(chosen);
    });

    function setTheme(selectedTheme) {
      // Remove existing theme classes
      document.body.classList.remove(
        'dark-theme',
        'psychedelic-theme',
        'purple-theme',
        'acid-theme',
        'matrix-theme'
      );

      // Add the chosen theme class if not "light"
      if (selectedTheme === 'dark') {
        document.body.classList.add('dark-theme');
      } else if (selectedTheme === 'psychedelic') {
        document.body.classList.add('psychedelic-theme');
      } else if (selectedTheme === 'purple') {
        document.body.classList.add('purple-theme');
      } else if (selectedTheme === 'acid') {
        document.body.classList.add('acid-theme');
      } else if (selectedTheme === 'matrix') {
        document.body.classList.add('matrix-theme');
      }
      // else, remain in default "light" theme
    }
  </script>
</body>
</html>